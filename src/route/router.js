const express = require('express')
const bodyParser = require('body-parser')
const cookieParser = require('cookie-parser')
const fingerprint = require('express-fingerprint')
const cors = require('cors')
const morgan = require('morgan')
const user = require('./private/user')
const project = require('./private/project')
const task = require('./private/task')
const auth = require('./public/auth')
const checkJwt = require('../middleware/checkJwt')
const error = require('../middleware/errorHandle')
const corsConfig = require('../config/corsConfig')
const fpConfig = require('../config/fingerprintConfig')

module.exports = (app) => {
  app.use(cors(corsConfig))
  app.use(bodyParser.urlencoded())
  app.use(bodyParser.json())
  app.use(bodyParser.raw())
  app.use(cookieParser())
  app.use(fingerprint(fpConfig))
  app.use(morgan('combined'))
  app.use('/public/files', express.static('public'))
  app.use('/api/auth', auth)
  app.use('/api/users', checkJwt, user)
  app.use('/api/project', checkJwt, project)
  app.use('/api/task', checkJwt, task)
  app.use(error)
}
